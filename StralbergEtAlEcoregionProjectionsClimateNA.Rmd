---
title: "Climate-projected distributional shifts and refugia for North American ecoregions"
author: "Diana Stralberg (diana.stralberg@ualberta.ca), AdaptWest Project"
output:
  html_document: default
  word_document: default
  pdf_document: default
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Climate model projections suggest major North American biome shifts in response to anthropogenic climate change (Rehfeldt et al. 2012). Such shifts could have profound influences on native flora and fauna, many of which would have to move long distances to track their climatic niches. To evaluate potential ecosystem changes at a somewhat finer scale, I projected the change in climate space for level III ecoregions (Commission for Environmental Cooperation 1997) as surrogates for multiple associated species and ecological communities. First, I developed a random forest model (Breiman 2001) to predict ecoregion class from bioclimatic variables (Table 1), using 1-km interpolated climate data for the 1969-1990 normal period (Hamann et al. 2013), available at http://adaptwest.databasin.org.

R Code for this portion follows:

```
library(randomForest)
library(raster)

#eco = project directory
setwd(eco)
datlcc = read.csv("CECEcoregionSampleLCC.csv")
cececo = read.csv("CECecoregions.csv")
LCC <- CRS("+proj=lcc +lat_1=49 +lat_2=77 +lat_0=0 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs")

#cur = directory containing grids representing derived climate variables
setwd(cur)
clim <- list.files(cur, pattern =".asc$")
curclim<-stack(clim)
temp <- raster(clim[1])
ID <- as.data.frame(rasterToPoints(temp))
names(ID)[3] <- "ID4km"
ID$ID <- row.names(ID)
IDR <- raster(ncols=ncol(temp), nrows=nrow(temp), xmn=xmin(temp), xmx=xmax(temp), ymn=ymin(temp), ymx=ymax(temp))
IDRR <- rasterize(as.matrix(ID[,1:2]), IDR, as.numeric(ID[,4]))
curclim <- addLayer(curclim,IDRR)

setwd(eco)
sampleclim<-cbind(datlcc,extract(curclim,as.matrix(cbind(datlcc[,3],datlcc[,4]))))
sc <- na.omit(sampleclim)
names(sc)[ncol(sc)] <- "IDgrid"
sc$NA_L3CODE <- as.factor(as.character(sc$NA_L3CODE))
lu <- as.data.frame(levels(sc$NA_L3CODE))
lu$level <- row.names(lu)
names(lu)[1] <- "NA_L3CODE"
write.csv(lu,file="ecoregionlu.csv",row.names=FALSE)

eco.rf <- randomForest(y=sc$NA_L3CODE, x=sc[,5:(ncol(sc)-1)],importance = TRUE, proximity = TRUE, data=sc)
round(importance(eco.rf), 2)
varImpPlot(eco.rf) 
ecocurr <- predict(curclim,eco.rf)
projection(ecocurr) <- LCC
writeRaster(ecocurr,filename="currentlcc.tif",datatype='INT4S',format="GTiff",overwrite=TRUE)
curfreq <- freq(ecocurr)
ecolu <- merge(lu,curfreq,by.x="level",by.y="value")
names(ecolu)[3] <- "curr"
```
**Table 1:** Bioclimatic variables used as inputs to random forest models (from Hamann et al. 2013)

MAT:  mean annual temperature (°C)  
MWMT: mean temperature of the warmest month (°C)    
MCMT: mean temperature of the coldest month (°C)  
TD:   difference between MCMT and MWMT, as a measure of continentality (°C)  
MAP:  mean annual precipitation (mm)  
MSP:  mean summer (May to Sep) precipitation (mm)  
AHM:  annual heat moisture index, calculated as (MAT+10)/(MAP/1000)  
SHM:  summer heat moisture index, calculated as MWMT/(MSP/1000)  
DD0: degree-days below 0°C (chilling degree days)    
DD5: degree-days above 5°C (growing degree days)  
DD18: degree-days below 18°C  
DD18: degree-days above 18°C  
NFFD: the number of frost-free days  
bFFP: the julian date on which the frost-free period begins  
eFFP: the julian date on which the frost-free period ends  
FFP: frost-free period  
PAS:  precipitation as snow (mm)  
EMT:  extreme minimum temperature over 30 years  
EXT: extreme maximum temperature over 30 years  
Eref: Hargreave's reference evaporation  
CMD:  Hargreave's climatic moisture index  
RH: mean annual relative humidity (%)  
Tavewt: winter (Dec to Feb) mean temperature (°C)  
Tavesm: summer (Jun to Aug) mean temperature (°C)  
PPTwt:  winter (Dec to Feb) precipitation (mm)  
PPTsm:  summer (Jun to Aug) precipitation (mm)  


This model was then used to project ecoregions onto future mid-century (2041-2070) and end-of-century (2071-2100) climate conditions. Climate projections were based on 1-km downscaled climate anomalies (Wang et al. 2016) generated by an ensemble of 15 widely-used GCMs from the Coupled Model Intercomparison Project, Phase 5 (CMIP5, Taylor et al. 2012), available at http://adaptwest.databasin.org. I used representative concentration pathway (RCP) 8.5, to represent the 21st century conditions that are to be expected without dramatic reductions in greenhouse gas emissions or technological fixes (Fuss et al. 2014). I also evaluated RCP 4.5 to represent a future in which significant emissions reductions are achieved.

The following code generates projections for each representative  and time period:

```
fut = directory containing grids representing derived future climate variables
rcp <- c("rcp45","rcp85")
time <- c("2050s","2080s")
for (j in rcp) {
	for (k in time) {
			w  <- paste(fut,"NA_ENSEMBLE_",j,"_",k,"_Bioclim_ASCII/",sep="")
			setwd(w)
			futclim <- list.files(w,pattern=".asc$")
			s <-stack(futclim)
			p <- predict(s,eco.rf)
			projection(p) <- LCC
			futfreq <- as.data.frame(freq(p))
	    names(futfreq)[2] <- paste(i,j,sep="_")
	    ecolu <- merge(ecolu,futfreq,by.x="level",by.y="value")
			writeRaster(p, filename=paste(eco,"pred",j,k,sep="_"),datatype='INT4S',format="GTiff", overwrite=TRUE)
			}
	}	
```
Results for RCP 4.5 and RCP 8.5 are shown in Figures 1 and 2, respectively:

![**Figure 1.** Model-predicted (a) baseline, (b) mid-century, and (c) end-of-century changes in North American ecoregions for RCP 4.5. Boreal, hemi-boreal, and western forested regions are shown in green and blue-green shades; arctic ecoregions are in blue shades; prairie/parkland ecoregions are in brown shades; and temperate forest ecoregions are in yellow and orange shades (see Table 1 for full list of ecoregions). Boreal ecoregions are also outlined in black.](ecoregion_cmip5_RCP45.png)

![**Figure 2.** Model-predicted (a) baseline, (b) mid-century, and (c) end-of-century changes in North American ecoregions for RCP 8.5. Boreal, hemi-boreal, and western forested regions are shown in green and blue-green shades; arctic ecoregions are in blue shades; prairie/parkland ecoregions are in brown shades; and temperate forest ecoregions are in yellow and orange shades (see Table 1 for full list of ecoregions). Boreal ecoregions are also outlined in black.](ecoregion_cmip5_RCP85.png)

Next, I used the following code to calculate the change in area (16 km2 pixels) for each Level III ecoregion (Table 2):

```
groups <- c("rcp45_2050s","rcp45_2080s","rcp85_2050s","rcp85_2080s")
setwd(eco)
for (i in groups) {
	g <- list.files(eco,pattern=i)
	g1 <- grep(pattern=".tif$",g,value=TRUE)
	m <- raster(g1)
	futfreq <- as.data.frame(freq(m))
	names(futfreq)[2] <- i
	ecolu <- merge(ecolu,futfreq,by.x="level",by.y="value")
	}
ecolu1 <- merge(unique(cececo[,c(2:4)]),ecolu[,2:7],by="NA_L3CODE")
write.csv(ecolu1,file="ecoregion_changesummary.csv",row.names=FALSE)
```

**Table 2.** Model-projected changes by ecoregion (sq km):

```{r,echo=FALSE}
library(knitr)
ecolu1<-read.csv("I:/GoogleDrive/COBB_ClimateChange/ACE-ECOResubmission/ecoref/ecoregion_changesummary.csv")
kable(ecolu1[,c(1:2,4:8)], digits=2)

```

I also specifically summarized changes for boreal ecoregions (4.1, 5.4, 5.1, 3.4, 3.3, 3.2, 3.1, and 6.1) (Table 3):

**Table 3.** Model-projected changes by boreal ecoregion (sq km):

```{r,echo=FALSE}
ecolu1<-read.csv("I:/GoogleDrive/COBB_ClimateChange/ACE-ECOResubmission/ecoref/ecoregion_changesummary.csv")
boreal <- c("4.1", "5.4","5.1","3.4","3.3","3.2","3.1","6.1")
borealeco <- ecolu1[ecolu1$NA_L2CODE %in% boreal,]
borealsum <- colSums(borealeco[,4:8])
kable(borealeco[,c(1:2,4:8)], digits=2,row.name="FALSE")

```

This translates into 14% and 42% losses of boreal climate space by 2041-2070 and 2071-2100, respectively, based on RCP 8.5; or 9% and 13% losses based on RCP 4.5

Change projections can be found at http://adaptwest.databasin.org.

**References**

Breiman, L. 2001. Random Forests. Machine Learning 45:5-32.

Commission for Environmental Cooperation. 1997. Ecological Regions of North America: Toward a Common Perspective, Montreal, Canada.

Fuss, S., J. G. Canadell, G. P. Peters, M. Tavoni, R. M. Andrew, P. Ciais, R. B. Jackson, C. D. Jones, F. Kraxner, N. Nakicenovic, C. Le Quere, M. R. Raupach, A. Sharifi, P. Smith, and Y. Yamagata. 2014. Betting on negative emissions. Nature Climate Change 4:850-853.

Hamann, A., T. Wang, D. L. Spittlehouse, and T. Q. Murdock. 2013. A comprehensive, high-resolution database of historical and projected climate surfaces for western North America. Bulletin of the American Meteorological Society 94:1307-1309.

Rehfeldt, G. E., N. L. Crookston, C. Sáenz-Romero, and E. M. Campbell. 2012. North American vegetation model for land-use planning in a changing climate: a solution to large classification problems. Ecological Applications 22:119-141.

Taylor, K. E., R. J. Stouffer, and G. A. Meehl. 2012. An Overview of CMIP5 and the Experiment Design. Bulletin of the American Meteorological Society 93:485-498.

Wang, T., A. Hamann, D. Spittlehouse, and C. Carroll. 2016. Locally Downscaled and Spatially Customizable Climate Data for Historical and Future Periods for North America. PLoS ONE 11:e0156720.
